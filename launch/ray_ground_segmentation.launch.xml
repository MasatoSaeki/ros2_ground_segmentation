<?xml version="1.0"?>
<launch>
    <set_parameter name="use_sim_time" value="true" />

    <arg name="sensor_height" default="0.00"/>
    <arg name="output_frame" default="base_link"/>

    <arg name="general_max_slope" default="10.0"/>
    <arg name="local_max_slope" default="10.0"/>
    <arg name="radial_divider_angle" default="0.1"/>
    <arg name="concentric_divider_distance" default="0.01"/>
    <arg name="min_height_threshold" default="0.1"/>
    <arg name="clipping_height" default="3.2"/>
    <arg name="pointcloud_min_z" default="-0.2"/>
    <arg name="min_point_distance" default="0.5"/>
    <arg name="reclass_distance_threshold" default="0.2"/>
    <arg name="outlier_filter" default="false"/>

    <arg name="intensity_filter" default="false"/>
    <arg name="min_intensity" default="25"/>
    <arg name="max_intensity_distance" default="20.0"/>

    <group>
        <node_container pkg="rclcpp_components" exec="component_container_mt" name="ros2_ground_segmentation" namespace="/">
            <composable_node pkg="pointcloud_preprocessor"
                            plugin="pointcloud_preprocessor::CropBoxFilterComponent"
                            name="crop_box_filter"
                            namespace="">
                <remap from="input" to="/sensing/lidar/concatenated/pointcloud" />
                <remap from="output" to="/new_gs/range_cropped/pointcloud" />
                <param name="input_frame" value="base_link"/>
                <param name="output_frame" value="base_link"/>
                <param name="min_x" value="-70.0"/>
                <param name="max_x" value="100.0"/>
                <param name="min_y" value="-75.0"/>
                <param name="max_y" value="75.0"/>
                <param name="negative" value="false"/>
                <param name="max_z" value="6.26"/> <!-- max_height_offset(3.06) + margin_max_z(3.2) -->
                <param name="min_z" value="-2.5"/> <!-- min_height_offset(0.0) + margin_min_z(-2.5) -->
                <extra_arg name="use_intra_process_comms" value="false" />
            </composable_node>
            <composable_node pkg="ros2_ground_segmentation"
                             plugin="RayGroundSegmentation"
                             name="ray_ground_filter_node"
                             namespace="">
                <remap from="input/topic" to="/new_gs/range_cropped/pointcloud" />
                <remap from="output/topic" to="/new_gs/points_processed" />

                <param name="sensor_height" value="$(var sensor_height)"/>
                <param name="output_frame" value="$(var output_frame)"/>
                <param name="general_max_slope" value="$(var general_max_slope)"/>
                <param name="local_max_slope" value="$(var local_max_slope)"/>
                <param name="radial_divider_angle" value="$(var radial_divider_angle)"/>
                <param name="concentric_divider_distance" value="$(var concentric_divider_distance)"/>
                <param name="min_height_threshold" value="$(var min_height_threshold)"/>
                <param name="clipping_height" value="$(var clipping_height)"/>
                <param name="pointcloud_min_z" value="$(var pointcloud_min_z)"/>
                <param name="min_point_distance" value="$(var min_point_distance)"/>
                <param name="reclass_distance_threshold" value="$(var reclass_distance_threshold)"/>
                <param name="outlier_filter" value="$(var outlier_filter)"/>
                <param name="intensity_filter" value="$(var intensity_filter)"/>
                <param name="min_intensity" value="$(var min_intensity)"/>
                <param name="max_intensity_distance" value="$(var max_intensity_distance)"/>

                <extra_arg name="use_intra_process_comms" value="false" />
            </composable_node>
        </node_container>
    </group>

</launch>