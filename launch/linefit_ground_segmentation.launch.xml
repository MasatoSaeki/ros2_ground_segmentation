<?xml version="1.0"?>
<launch>
    <set_parameter name="use_sim_time" value="true" />

    <arg name="r_min" default="0.1"/>
    <arg name="r_max" default="20.0"/>
    <arg name="bins_num" default="100"/>
    <arg name="segs_num" default="20"/>
    <arg name="threads_num" default="4"/>
    <arg name="max_slope" default="0.1"/>
    <arg name="max_dist_to_line" default="0.15"/>
    <arg name="long_thres" default="0.5"/>
    <arg name="max_long_height" default="0.1"/>
    <arg name="max_start_height" default="0.1"/>
    <arg name="line_search_angle" default="1.0"/>
    <arg name="max_error" default="0.02"/>
    <arg name="sensor_height" default="0.0"/>
    <arg name="output_frame" default="base_link"/>

    <node_container pkg="rclcpp_components" exec="component_container_mt" name="ros2_ground_segmentation" namespace="/">
            <composable_node pkg="pointcloud_preprocessor"
                            plugin="pointcloud_preprocessor::CropBoxFilterComponent"
                            name="crop_box_filter"
                            namespace="">
                <remap from="input" to="/sensing/lidar/concatenated/pointcloud" />
                <remap from="output" to="/new_gs/range_cropped/pointcloud" />
                <param name="input_frame" value="base_link"/>
                <param name="output_frame" value="base_link"/>
                <param name="min_x" value="-70.0"/>
                <param name="max_x" value="100.0"/>
                <param name="min_y" value="-75.0"/>
                <param name="max_y" value="75.0"/>
                <param name="negative" value="false"/>
                <param name="max_z" value="6.26"/> <!-- max_height_offset(3.06) + margin_max_z(3.2) -->
                <param name="min_z" value="-2.5"/> <!-- min_height_offset(0.0) + margin_min_z(-2.5) -->
                <extra_arg name="use_intra_process_comms" value="false" />
            </composable_node>
            <composable_node pkg="ros2_ground_segmentation"
                             plugin="LinefitGroundSegmentation"
                             name="linefit_ground_segmentation_node"
                             namespace="">
                <remap from="input/topic" to="/new_gs/range_cropped/pointcloud" />
                <remap from="output/topic" to="/new_gs/points_processed" />
                <param name="r_min" value="$(var r_min)"/>
                <param name="r_max" value="$(var r_max)"/>
                <param name="bins_num" value="$(var bins_num)"/>
                <param name="segs_num" value="$(var segs_num)"/>
                <param name="threads_num" value="$(var threads_num)"/>
                <param name="max_slope" value="$(var max_slope)"/>
                <param name="max_dist_to_line" value="$(var max_dist_to_line)"/>
                <param name="long_thres" value="$(var long_thres)"/>
                <param name="max_long_height" value="$(var max_long_height)"/>
                <param name="max_start_height" value="$(var max_start_height)"/>
                <param name="line_search_angle" value="$(var line_search_angle)"/>
                <param name="max_error" value="$(var max_error)"/>
                <param name="sensor_height" value="$(var sensor_height)"/>
                <param name="output_frame" value="$(var output_frame)"/>

                <extra_arg name="use_intra_process_comms" value="false" />
            </composable_node>
        </node_container>

</launch>